<div class="row row-space-6" style="padding-bottom: 10px">
  <div class="col-xs-12 ">

    <div class="row row-space-12">
      <div class="col-xs-12">
        <h2>Weams</h2>
        <table class="table table-hover table-condensed table-bordered table-responsive">
          <thead>
            <th>Name</th>
            <th>Facility Code</th>
            <th>City</th>
            <th>State</th>
            <th>IPEDS</th>
            <th>OPE</th>
          </thead>
          <tbody>
            <td><%= @issue.weam.institution %></td>
            <td><%= @issue.weam.facility_code %></td>
            <td><%= @issue.weam.city %></td>
            <td><%= @issue.weam.state %></td>
            <td><%= @issue.weam.cross %></td>
            <td><%= @issue.weam.ope %></td>
          </tbody>
        </table>
      </div>
    </div>


    <div class="row row-space-12">
      <div class="col-xs-12">
        <h2>IPEDS HD</h2>
        <% if @ipeds_hd_arr.any? %>
          <table class="table table-hover table-condensed table-bordered table-responsive">
            <thead>
            <th>Name</th>
            <th>Address</th>
            <th>OPE</th>
            <th>IPE</th>
            <th>Matching Score</th>
            <th>Actions</th>
            </thead>
            <tbody>
            <tr>
              <td><%= @issue.ipeds_hd&.institution %></td>
              <td><%= [@issue.ipeds_hd&.addr, @issue.ipeds_hd&.state, @issue.ipeds_hd&.city, @issue.ipeds_hd&.zip].compact.join(", ") %></td>
              <td><%= @issue.ipeds_hd&.ope %></td>
              <td><%= @issue.ipeds_hd&.cross %></td>
              <td />
              <td><%= submit_tag( "Match", class: 'btn dashboard-btn-success', data: { confirm: "Are you sure?" })%></td>
            </td>
            <% @ipeds_hd_arr.each do |iped| %>
              <tr>
                <td><%= iped["institution"] %></td>
                <td><%= [iped["addr"], iped["state"], iped["city"], iped["zip"]].compact.join(", ") %></td>
                <td><%= iped["ope"] %></td>
                <td><%= iped["cross"] %></td>
                <td><%= (iped["match_score"].to_f * 100).round(3) %>%</td>
                <td>
                  <%= form_with(url: crosswalk_issues_match_ipeds_hd_path) do %>
                    <input type="hidden" name="issue_id" value="<%= @issue.id %>" />
                    <input type="hidden" name="iped_id" value="<%= iped["id"] %>" />
                    <%= submit_tag( "Match", class: 'btn dashboard-btn-success', data: { confirm: "Are you sure?" })%>
                  <% end %>
                </td>
              </tr>
            <% end %>
            </tbody>
          </table>
        <% else %>
          <p>No matches found.</p>
        <% end %>
      </div>
    </div>


    <div class="row row-space-12">
      <div class="col-xs-12">
        <h2>Crosswalk</h2>
      </div>
    </div>
    <div class="row row-space-12">
      <div class="col-xs-12">
        <%= form_with(url: crosswalk_issues_resolve_partial_path) do %>
          <input type="hidden" name="id" value="<%= @issue.id %>" />
          <table class="table table-hover table-condensed table-bordered table-responsive">
            <thead>
              <th>Name</th>
              <th>Facility Code</th>
              <th>City</th>
              <th>State</th>
              <th><%= label_tag('cross', 'IPEDS') %></th>
              <th><%= label_tag('ope', 'OPE') %></th>
              <th><%= label_tag('notes', 'Notes') %></th>
            </thead>
            <tbody>
              <td>
                <% if @issue.crosswalk.present? && @issue.weam.institution != @issue.crosswalk.institution %>
                  <div class="weams_override"><del><%= @issue.crosswalk&.institution %></del></div>
                <% end %>
                <%= @issue.weam.institution %>
              </td>
              <td>
                <% if @issue.crosswalk.present? && @issue.weam.facility_code != @issue.crosswalk.facility_code %>
                  <div class="weams_override"><del><%= @issue.crosswalk&.facility_code %></del></div>
                <% end %>
                <%= @issue.weam.facility_code %>
              </td>
              <td>
                <% if @issue.crosswalk.present? && @issue.weam.city != @issue.crosswalk.city %>
                  <div class="weams_override"><del><%= @issue.crosswalk&.city %></del></div>
                <% end %>
                <%= @issue.weam.city %>
              </td>
              <td>
                <% if @issue.crosswalk.present? && @issue.weam.state != @issue.crosswalk.state %>
                  <div class="weams_override"><del><%= @issue.crosswalk&.state %></del></div>
                <% end %>
                <%= @issue.weam.state %>
              </td>
              <td>
                <%= text_field_tag(:cross, @issue.crosswalk&.cross) %>
              </td>
              <td>
                <%= text_field_tag(:ope, @issue.crosswalk&.ope) %>
              </td>
              <td>
                <%= text_field_tag(:notes, @issue.crosswalk&.notes) %>
              </td>
            </tbody>
          </table>

          <input
            type="button"
            id="set_from_ipeds"
            class="btn dashboard-btn-warning crosswalk_update"
            value="Update Crosswalk from WEAMS"
            cross="<%= @issue.weam.cross %>"
            ope="<%= @issue.weam.ope %>"
          />

          <input
            type="button"
            id="set_from_weams"
            class="btn dashboard-btn-warning crosswalk_update"
            <%= @issue.ipeds_hd.presence || 'disabled' %>
            value="Update Crosswalk from IPEDS"
            cross="<%= @issue.ipeds_hd&.cross %>"
            ope="<%= @issue.ipeds_hd&.ope %>"
          />

          <input type="button" id="clear_ipeds_ope" class="btn dashboard-btn-warning" value="Clear IPEDS/OPE" />

          <%= submit_tag("Update", class: 'btn dashboard-btn-success') %>
        <% end %>
      </div>
    </div>
  </div>
</div>
